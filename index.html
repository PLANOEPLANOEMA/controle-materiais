<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Controle de Materiais - Plano & Plano</title>
</head>
<body>

<!-- COLE AQUI O SEU INDEX ATUAL (TUDO) E DEIXE ESTE BLOCO NO FINAL -->


<script type="module">
import { salvarNaNuvem, carregarDaNuvem, escutarMudancas } from './firebase.js';

window.addEventListener('DOMContentLoaded', async ()=>{
  const originalInit = app.init.bind(app);
  app.init = async function(){
    try{
      const cloud = await carregarDaNuvem();
      if (cloud && Array.isArray(cloud)) {
        this.dados = cloud;
      }
    }catch(e){ console.log('Cloud load fail', e); }
    originalInit();
    escutarMudancas((regs)=>{
      if(!Array.isArray(regs)) return;
      this.dados = regs;
      this.atualizarUI();
    });
  };

  const originalSalvar = app.salvarDados.bind(app);
  app.salvarDados = function(){
    originalSalvar();
    salvarNaNuvem(this.dados);
  };
});
</script>


</body>
</html>
